<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<title>Cryptopay demon service</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="./assets/bootstrap.min.css" rel="stylesheet">
	<link href="./assets/main.css" rel="stylesheet" type="text/css">
	<link href="./assets/style.css" rel="stylesheet">
</head>

<body>
	<header class="main__header">
		<div class="container">
			<nav class="navbar navbar-default" role="navigation">
				<div class="menuBar">
					<ul class="menu">
						<li class="active"><a>Home</a></li>
						<li><a>Pages</a></li>
						<li><a>left sidebar</a></li>
					</ul>
					<ul class="menu m_right">
						<li><a>right sidebar</a></li>
						<li><a>full page</a></li>
						<li><a>contact us</a></li>
					</ul>
				</div>
				<div class="navbar-header">
					<h1 class="navbar-brand">
						<a>gambling</a>
					</h1>
				</div>
			</nav>
		</div>
	</header>
	<section class="slider">
		<div id="myCarousel" class="carousel slide carousel-fade" data-ride="carousel">
			<div class="carousel-inner">
				<div class="item">
					<img data-src="images/slider/slider.jpg" alt="First slide" src="./assets/slider.jpg">
					<div class="container">
						<div class="carousel-caption"></div>
					</div>
				</div>
				<div class="item">
					<img data-src="images/slider/slider1.jpg" alt="Second slide" src="./assets/slider1.jpg">
				</div>
				<div class="item active"> <img data-src="images/slider/slider2.jpg" alt="Third slide"
						src="./assets/slider2.jpg">
				</div>
			</div>
			<div class="form-container">
				<h1 class="page_title">Make deposit</h1>
				<div class="form-wrapper">
					<a id="make-eur-deposit" class="btn btn-default btn-lg">EUR deposit</a>
					<select class="custom-select" id="deposit-amount">
						<option class="custom-select-options" value="5">5</option>
						<option class="custom-select-options" value="10">10</option>
						<option class="custom-select-options" value="25">25</option>
						<option class="custom-select-options" value="50">50</option>
						<option class="custom-select-options" value="100">100</option>
						<option class="custom-select-options" value="200">200</option>
						<option class="custom-select-options" value="500">500</option>
					</select>
					<a id="make-usd-deposit" class="btn btn-default btn-lg">USD deposit</a>
				</div>
			</div>
		</div>
	</section>
	<section class="main__middle__container homepage">
		<div class="row headings text-center no-margin nothing">
			<div class="container">
				<h1 class="page_title">Cryptopay demo service</h1>
				<p>Some information about service capabilities.</p>
				<p><a class="btn btn-default btn-lg" href="http://google.com" role="button">Tell me more</a></p>
			</div>
		</div>
	</section>
	<section class="main__middle__container">
		<p class="text-center copyright">&copy; Copyright Cryptopay. All Rights Reserved.</p>
	</section>
	</section>
	<script type="text/javascript" src="./assets/jquery.min.js"></script>
	<script src="./assets/bootstrap.min.js"></script>
	<script type="text/javascript">
		$('.carousel').carousel({
			interval: 3500,
			pause: 'none'
		});
	</script>

	<!--Start Cryptopay widget handler-->
	<script type="text/javascript">
		const makeUSDDepositButton = document.querySelector('#make-usd-deposit');
		const makeEURDepositButton = document.querySelector('#make-eur-deposit');
		const depositAmountSelect = document.querySelector('#deposit-amount');
		const widgetIframeId = 'cryptopay-widget';

		window.addEventListener('message', (event) => widgetMessageHandler(event.data));
		makeUSDDepositButton.addEventListener('click', () => onPayButtonClickWidget('USD', depositAmountSelect.value));
		makeEURDepositButton.addEventListener('click', async () => onPayButtonClick('EUR', depositAmountSelect.value));

		async function onPayButtonClick(currency, amount) {
			try {
				const { paymentURL } = await getPaymentURL(currency, amount);
				window.open(paymentURL);
			} catch (e) {
				alert('Cannot open payment widget. ' + e.message);
				console.error(e);
			}
		}

		async function onPayButtonClickWidget(currency, amount) {
			try {
				const { paymentURL } = await getPaymentURL(currency, amount);
				showWidget(paymentURL);
			} catch (e) {
				alert('Cannot open payment widget. ' + e.message);
				console.error(e);
			}
		}

		async function getPaymentURL(currency, amount) {
			let webAppLocation = window.location.toString();
			if (!webAppLocation.endsWith('/')) { webAppLocation += '/'; }
			const fetchResponse = await fetch(`${webAppLocation}api`, {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ currency, amount }),
			});

			if (fetchResponse.ok !== true) {
				throw new Error(`${fetchResponse.status} ${fetchResponse.statusText}`);
			}

			const json = await fetchResponse.json();

			if (json.error) {
				throw new Error(json.error);
			}

			return json;
		}

		function widgetMessageHandler(data) {
			if (data.type === 'HIDE') {
				hideWidget();
			}
		}

		function showWidget(paymentURL) {
			let iframe = window.document.getElementById(widgetIframeId);
			if (!iframe) {
				iframe = document.createElement('iframe');
				iframe.id = widgetIframeId;
				iframe.style.zIndex = '999999';
				iframe.style.width = '100vw';
				iframe.style.height = '100vh';
				iframe.style.position = 'fixed';
				iframe.style.display = 'block';
				iframe.style.top = 0;
				iframe.style.left = 0;
				iframe.frameBorder = "0"  
				window.document.body.appendChild(iframe);
			}
			document.body.style.overflow = 'hidden';
			iframe.src = paymentURL;
		}

		function hideWidget() {
			const settedIfreme = window.document.getElementById(widgetIframeId)
			if (settedIfreme) {
				settedIfreme.remove();
				document.body.style.overflow = 'auto';
			}
		}
	</script>
	<!--End Cryptopay widget handler-->
</body>

</html>